{
  "info": {
    "_postman_id": "2f5be9ae-4aab-4c1b-9d47-2f3e6c2b0001",
    "name": "Ach Pet API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "GET /health",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/health", "host": ["{{baseUrl}}"], "path": ["health"] }
          }
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "POST /auth/register (SHELTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"SHELTER\",\n  \"name\": \"ONG Teste\",\n  \"email\": \"shelter+postman@achpet.local\",\n  \"password\": \"123456\",\n  \"phone\": \"11999999999\",\n  \"orgName\": \"ONG Teste\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth", "register"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 201', () => pm.response.code === 201);",
                  "const json = pm.response.json();",
                  "if (json.token) pm.environment.set('tokenShelter', json.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /auth/register (ADOPTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"ADOPTER\",\n  \"name\": \"Adotante Teste\",\n  \"email\": \"adopter+postman@achpet.local\",\n  \"password\": \"123456\",\n  \"phone\": \"11988888888\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth", "register"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 201', () => pm.response.code === 201);",
                  "const json = pm.response.json();",
                  "if (json.token) pm.environment.set('tokenAdopter', json.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /auth/login (SHELTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"shelter@achpet.local\",\n  \"password\": \"123456\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "if (json.token) pm.environment.set('tokenShelter', json.token);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /auth/login (ADOPTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"adopter@achpet.local\",\n  \"password\": \"123456\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth", "login"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "if (json.token) pm.environment.set('tokenAdopter', json.token);"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Pets",
      "item": [
        {
          "name": "POST /pets (SHELTER)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenShelter}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Luna\",\n  \"species\": \"Gato\",\n  \"breed\": \"SRD\",\n  \"sex\": \"F\",\n  \"ageMonths\": 10,\n  \"size\": \"P\",\n  \"description\": \"Carinhosa e saudável.\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/pets", "host": ["{{baseUrl}}"], "path": ["pets"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 201', () => pm.response.code === 201);",
                  "const json = pm.response.json();",
                  "if (json.pet?.id) pm.environment.set('petId', json.pet.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /pets/mine (SHELTER)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": { "raw": "{{baseUrl}}/pets/mine", "host": ["{{baseUrl}}"], "path": ["pets", "mine"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "pm.test('retorna { pets: [] }', () => Array.isArray(json.pets));"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /pets",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/pets", "host": ["{{baseUrl}}"], "path": ["pets"] }
          }
        },
        {
          "name": "GET /pets/:id",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{baseUrl}}/pets/{{petId}}", "host": ["{{baseUrl}}"], "path": ["pets", "{{petId}}"] }
          }
        },
        {
          "name": "PATCH /pets/:id (SHELTER)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenShelter}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"PAUSED\",\n  \"description\": \"Pausado para revisão\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/pets/{{petId}}", "host": ["{{baseUrl}}"], "path": ["pets", "{{petId}}"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "pm.test('retorna pet', () => !!json.pet);",
                  "pm.test('status atualizado', () => json.pet?.status === 'PAUSED');"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /pets/:id/favorite (ADOPTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenAdopter}}" }],
            "url": { "raw": "{{baseUrl}}/pets/{{petId}}/favorite", "host": ["{{baseUrl}}"], "path": ["pets", "{{petId}}", "favorite"] }
          }
        }
      ]
    },
    {
      "name": "Adoptions",
      "item": [
        {
          "name": "POST /adoptions/requests (ADOPTER)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenAdopter}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"petId\": \"{{petId}}\",\n  \"message\": \"Tenho experiência e aceito acompanhamento.\"\n}"
            },
            "url": { "raw": "{{baseUrl}}/adoptions/requests", "host": ["{{baseUrl}}"], "path": ["adoptions", "requests"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 201', () => pm.response.code === 201);",
                  "const json = pm.response.json();",
                  "if (json.request?.id) pm.environment.set('requestId', json.request.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /adoptions/requests/inbox (SHELTER)",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": { "raw": "{{baseUrl}}/adoptions/requests/inbox", "host": ["{{baseUrl}}"], "path": ["adoptions", "requests", "inbox"] }
          }
        },
        {
          "name": "POST /adoptions/requests/:id/approve (SHELTER)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenShelter}}" }
            ],
            "body": { "mode": "raw", "raw": "{\n  \"followUpDays\": 14\n}" },
            "url": {
              "raw": "{{baseUrl}}/adoptions/requests/{{requestId}}/approve",
              "host": ["{{baseUrl}}"],
              "path": ["adoptions", "requests", "{{requestId}}", "approve"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "if (json.adoption?.id) pm.environment.set('adoptionId', json.adoption.id);",
                  "if (json.adoption?.thread?.id) pm.environment.set('threadId', json.adoption.thread.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /adoptions/requests/:id/reject (SHELTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": {
              "raw": "{{baseUrl}}/adoptions/requests/{{requestId}}/reject",
              "host": ["{{baseUrl}}"],
              "path": ["adoptions", "requests", "{{requestId}}", "reject"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /adoptions/:adoptionId/intervene (SHELTER)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": {
              "raw": "{{baseUrl}}/adoptions/{{adoptionId}}/intervene",
              "host": ["{{baseUrl}}"],
              "path": ["adoptions", "{{adoptionId}}", "intervene"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('status 200', () => pm.response.code === 200);",
                  "const json = pm.response.json();",
                  "pm.test('status INTERVENTION', () => json.adoption?.status === 'INTERVENTION');"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Chat",
      "item": [
        {
          "name": "POST /chat/threads/:threadId/messages",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenAdopter}}" }
            ],
            "body": { "mode": "raw", "raw": "{\n  \"content\": \"Olá! Quando posso buscar o pet?\"\n}" },
            "url": {
              "raw": "{{baseUrl}}/chat/threads/{{threadId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["chat", "threads", "{{threadId}}", "messages"]
            }
          }
        },
        {
          "name": "GET /chat/threads/:threadId/messages",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": {
              "raw": "{{baseUrl}}/chat/threads/{{threadId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["chat", "threads", "{{threadId}}", "messages"]
            }
          }
        }
      ]
    },
    {
      "name": "Follow-up",
      "item": [
        {
          "name": "POST /followup/adoptions/:adoptionId/updates",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenAdopter}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Primeira semana OK, tudo certo!\",\n  \"photoUrl\": \"/uploads/demo-photo.jpg\"\n}" 
            },
            "url": {
              "raw": "{{baseUrl}}/followup/adoptions/{{adoptionId}}/updates",
              "host": ["{{baseUrl}}"],
              "path": ["followup", "adoptions", "{{adoptionId}}", "updates"]
            }
          }
        },
        {
          "name": "GET /followup/adoptions/:adoptionId/updates",
          "request": {
            "method": "GET",
            "header": [{ "key": "Authorization", "value": "Bearer {{tokenShelter}}" }],
            "url": {
              "raw": "{{baseUrl}}/followup/adoptions/{{adoptionId}}/updates",
              "host": ["{{baseUrl}}"],
              "path": ["followup", "adoptions", "{{adoptionId}}", "updates"]
            }
          }
        }
      ]
    }
  ]
}
